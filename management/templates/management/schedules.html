{% extends 'core/base.html' %} {% load static %} {% block head %}
<title>Horários</title>
<link rel="stylesheet" href="{% static 'core/dist/css/schedule.css' %}" />
<script defer>
  // To whoever may optimize this in the future:
  // Remember to go outside and get some fresh air.
  document.addEventListener("alpine:init", () => {
    Alpine.data("timeTable", () => ({
      init() {
        const days = [
          // {% for day in days %}
          "{{ day.1 }}",
          // {% endfor %}
        ];

        const times = [
          // {% for t in time_table %}
          "{{ t.0 }}",
          // {% endfor %}
        ];

        const programmings = [
          //{% for p in programmings %}
          JSON.parse("{{ p.json }}".replace(/&quot;/g, '"')),
          // {% endfor %}
        ];

        const cells = document.querySelectorAll("tr > td:not(:first-child)");

        cells.forEach((el, i) =>
          el.addEventListener("click", () => {
            this.programmingTime = Math.floor(i / 5);
            this.programmingTimeShow = times[this.programmingTime];
            this.programmingDay = i % 5;
            this.programmingDayShow = days[this.programmingDay];
            const selected = programmings.filter(
              (p) => p.order == Math.floor(i / 5) && p.day == i % 5
            );

            // TODO: optimize + make prettyyy
            if (selected.length == 0) return;
            if (selected.length == 1) {
              this.teacher = selected[0].teacher;
              this.studentGroup = false;
            }
            if (selected.length == 2) {
              // TODO
            }
          })
        );

        programmings.forEach((p) => {
          cells[p.order * 5 + p.day].innerHTML = p.subject_slug;
        });
      },
      time: "{{ classroom.course.time }}",
      programmingTime: 1,
      programmingTimeShow: "",
      programmingDay: 1,
      programmingDayShow: "",
      teacher: "",
      teacherB: "",
      studentGroup: false,
    }));
  });
</script>
{% endblock %} {% block content %}
<main class="p-10" x-data="timeTable">
  <h1 class="mb-4 text-4xl font-semibold">Horários - {{ classroom }}</h1>
  <article class="grid grid-cols-2 gap-20">
    <table
      class="table-fixed border-separate border-spacing-2 rounded-2xl bg-zinc-300 p-4"
    >
      <thead class="bg-transparent">
        <tr>
          <th></th>
          {% for day in days %}
          <th class="text-yellow-900">{{ day.1 }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for t in time_table %}
        <tr>
          <td class="mr-10 rounded-xl bg-color-primary-dimm text-white">
            {{ t.0 }}
          </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <section class="rounded-xl bg-zinc-300 p-5">
      <h2 class="mb-3 text-2xl font-semibold">Editar aula</h2>
      <form
        action="{% url 'schedules' classroom.pk %}"
        method="post"
        class="flex flex-col justify-end"
      >
        {% csrf_token %}
        <input type="hidden" name="classroom" value="{{ classroom.pk }}" />
        <section class="flex gap-2 p-4">
          <input type="text" hidden id="txt-classroom" name="classroom" />
          <div>
            <label class="text-slate-500" id="txt-day">Dia:</label>
            <input
              type="text"
              readonly
              class="bg-slate-200 text-slate-500"
              id="txt-day"
              size="8"
              maxlength="3"
              x-model="programmingDayShow"
            />
            <input type="number" hidden name="day" x-model="programmingDay" />
          </div>
          <div>
            <label class="text-slate-500" id="txt-time">Horário:</label>
            <input
              type="text"
              readonly
              class="bg-slate-200 text-slate-500"
              id="txt-time"
              size="6"
              x-model="programmingTimeShow"
            />
            <input type="number" hidden name="time" x-model="programmingTime" />
          </div>
        </section>
        <section class="flex flex-col gap-3 rounded-xl bg-zinc-200 p-4">
          <div class="flex">
            <div class="flex flex-col gap-3">
              <div>
                <label
                  for="sl-subject"
                  x-text="`Matéria${studentGroup ? ' A' : ''}:`"
                ></label>
                <select name="subject" id="sl-subject">
                  {% for subject in subjects %}
                  <option value="{{ subject.pk }}">{{ subject.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div>
                <label
                  for="txt-teacher"
                  x-text="`Professor${studentGroup ? ' A' : ''}:`"
                ></label>
                <input
                  type="text"
                  name="teacher"
                  id="txt-teacher"
                  x-model="teacher"
                />
              </div>
            </div>
            <template x-if="studentGroup != ''">
              <div class="flex flex-col gap-3">
                <div>
                  <label for="sl-subject">Matéria B:</label>
                  <select name="subject_b" id="sl-subject">
                    {% for subject in subjects %}
                    <option value="{{ subject.pk }}">{{ subject.name }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div>
                  <label for="txt-teacher">Professor B:</label>
                  <input
                    type="text"
                    name="teacher_b"
                    id="txt-teacher"
                    x-model="teacherB"
                  />
                </div>
              </div>
            </template>
          </div>
          <div class="flex items-center gap-2">
            <label for="ch-group">Divisão de turmas:</label>
            <input
              type="checkbox"
              name="group"
              id="ch-group"
              x-model="studentGroup"
            />
          </div>
          <div>
            <button type="submit" class="px-6 py-2">Salvar</button>
          </div>
        </section>
      </form>
    </section>
  </article>
</main>
{% endblock %}
